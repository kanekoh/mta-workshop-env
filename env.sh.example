#!/bin/bash

###############################################################################
# 環境変数設定ファイル
# 
# 使用方法：
# 1. このファイルを env.sh にコピー
#    cp env.sh.example env.sh
# 
# 2. 各変数を実際の値に置き換える
# 
# 3. 環境変数を読み込む
#    source env.sh
###############################################################################

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# AWS認証情報
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
export AWS_ACCESS_KEY_ID="YOUR_AWS_ACCESS_KEY_ID"
export AWS_SECRET_ACCESS_KEY="YOUR_AWS_SECRET_ACCESS_KEY"
export AWS_DEFAULT_REGION="ap-northeast-1"

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Red Hat Cloud Services 認証
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# ROSA CLI にログインするには以下のいずれかを実行してください：
#   ブラウザ環境:   rosa login --use-auth-code
#   ブラウザレス環境: rosa login --use-device-code
#
# Terraform (RHCS provider) 向けの認証方法:
# サービスアカウント（推奨）
# 以下の環境変数を設定すると、Terraformが自動的にRHCS providerの認証に使用します
export RHCS_CLIENT_ID="YOUR_RHCS_CLIENT_ID"
export RHCS_CLIENT_SECRET="YOUR_RHCS_CLIENT_SECRET"

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Terraform変数（TF_VAR_プレフィックスで自動認識）
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#
# 【重要】変数の設定方法と優先順位
# 1. terraform.tfvars で指定した値（最優先）
# 2. TF_VAR_* 環境変数（このファイルで設定）
# 3. variables.tf のデフォルト値（最低優先度）
#
# 【デフォルト値で問題ない場合】
#   → 以下の変数は variables.tf にデフォルト値が設定されているため、
#     設定しなくてもデフォルト値が使用されます。
#     デフォルト値で問題ない場合は、これらの行をコメントアウトまたは削除してください。
#
# 【デフォルト値と異なる値が必要な場合】
#   → 以下の行のコメントを外して、実際の値に置き換えてください。
#
# 必須設定（デフォルト値あり、カスタマイズ可能）
export TF_VAR_aws_region="ap-northeast-1"              # デフォルト: "ap-northeast-1"
export TF_VAR_cluster_name="mta-lightspeed"            # デフォルト: "mta-lightspeed"
export TF_VAR_ocp_version="4.20.2"                     # デフォルト: "4.19"
export TF_VAR_billing_account="YOUR_BILLING_ACCOUNT_ID"  # 機密情報（デフォルト: ""）

# その他のTerraform変数（デフォルト値あり、カスタマイズ可能）
export TF_VAR_rosa_machine_type="m6a.2xlarge"          # デフォルト: "m6a.2xlarge"
export TF_VAR_rosa_replicas="2"                        # デフォルト: 2
export TF_VAR_vpc_cidr="10.0.0.0/16"                   # デフォルト: "10.0.0.0/16"
export TF_VAR_availability_zone_count="1"              # デフォルト: 1

# 管理者・ワークショップユーザー人数（任意）
# export TF_VAR_admin_count="1"           # 管理者: admin, admin2, ...
# export TF_VAR_workshop_user_count="20"  # 受講者: user1..userN

# HTPasswd IDP 用パスワード（任意・機密情報のためコメントアウト例のみ）
# 管理者ユーザー (admin) 用パスワード
# export TF_VAR_admin_password="YOUR_ADMIN_PASSWORD"
#
# ワークショップユーザー (user1-user50) 共通パスワード
# export TF_VAR_workshop_user_password="YOUR_WORKSHOP_USER_PASSWORD"

# 追加MachinePool設定（任意）
# 1つ目のMachinePoolは module.rosa_hcp が自動で作成（削除不可）
# 2つ目以降の追加MachinePoolを定義する場合は terraform.tfvars で設定してください
# 環境変数での設定は複雑なため、terraform.tfvars の使用を推奨します
# 例: terraform/cluster/terraform.tfvars.example を参照

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# GitOps環境設定（任意）
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# デプロイするGitOps環境を指定します
# デフォルト: "mta" (MTA用の環境)
# 別の環境をデプロイする場合は、以下の行のコメントを外して環境名を指定してください：
# export GITOPS_ENV="mta"        # MTA用の環境（デフォルト）
# export GITOPS_ENV="other"       # その他用の環境
#
# 注意:
#   - 環境名に対応するディレクトリが gitops/environments/{GITOPS_ENV}/apps/ に存在する必要があります
#   - デフォルトでは "mta" 環境が使用されます
#   - この設定はAnsibleでGitOpsのapp-of-appsパスを決定するために使用されます

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Ansible実行制御（任意）
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# deploy.sh で Ansible playbook を実行するかどうかを制御します
# デフォルト: スキップ（Ansibleは実行されません）
# Ansibleを実行する場合は、以下の行のコメントを外してください：
# export RUN_ANSIBLE="true"
#
# 注意: Ansibleを実行するには、以下が必要です：
#   - Ansibleがインストールされていること
#   - cluster_info.json が ansible/ ディレクトリに存在すること
#   - クラスターへのアクセス権限があること

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# スクリプト実行ログ（任意）
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# deploy.sh と destroy.sh のログ出力を有効にする場合
# コマンドラインオプション（--log または --log-file）でも指定可能
# 環境変数での指定は、コマンドラインオプションで上書きされます

# デプロイスクリプトのログファイル（任意）
# export DEPLOY_LOG_FILE="deploy-$(date +%Y%m%d-%H%M).log"
# または、デフォルトファイル名を使用する場合:
# ./deploy.sh --log

# 削除スクリプトのログファイル（任意）
# export DESTROY_LOG_FILE="destroy-$(date +%Y%m%d-%H%M).log"
# または、デフォルトファイル名を使用する場合:
# ./destroy.sh --log

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# レガシー変数（後方互換性のため保持）
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
export CLUSTER_NAME="${TF_VAR_cluster_name}"
export VPC_NAME="${CLUSTER_NAME}-vpc"
export VPC_CIDR="${TF_VAR_vpc_cidr}"
export OCP_VERSION="${TF_VAR_ocp_version}"
export ROSA_MACHINE_TYPE="${TF_VAR_rosa_machine_type}"
export ROSA_REPLICAS="${TF_VAR_rosa_replicas}"

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "✅ 環境変数を読み込みました"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "AWS設定:"
echo "  Region: ${AWS_DEFAULT_REGION}"
echo ""
echo "Terraform変数:"
echo "  Cluster Name: ${TF_VAR_cluster_name}"
echo "  OCP Version: ${TF_VAR_ocp_version}"
echo "  Machine Type: ${TF_VAR_rosa_machine_type}"
echo "  Replicas: ${TF_VAR_rosa_replicas}"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"


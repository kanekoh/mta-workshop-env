#!/bin/bash

###############################################################################
# 環境変数設定ファイル
# 
# 使用方法：
# 1. このファイルを env.sh にコピー
#    cp env.sh.example env.sh
# 
# 2. 各変数を実際の値に置き換える
# 
# 3. 環境変数を読み込む
#    source env.sh
###############################################################################

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# AWS認証情報
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
export AWS_ACCESS_KEY_ID="YOUR_AWS_ACCESS_KEY_ID"
export AWS_SECRET_ACCESS_KEY="YOUR_AWS_SECRET_ACCESS_KEY"
export AWS_DEFAULT_REGION="ap-northeast-1"

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Red Hat Cloud Services 認証
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# ROSA CLI にログインするには以下のいずれかを実行してください：
#   ブラウザ環境:   rosa login --use-auth-code
#   ブラウザレス環境: rosa login --use-device-code
#
# Terraform (RHCS provider) 向けの認証方法:
#
# 方法1: サービスアカウント（推奨、ただし一部操作で権限不足の可能性あり）
#   export RHCS_CLIENT_ID="YOUR_RHCS_CLIENT_ID"
#   export RHCS_CLIENT_SECRET="YOUR_RHCS_CLIENT_SECRET"
#
# 方法2: 一時トークン（MachinePool作成時など、一部操作で必要）
#   まず rosa login を実行:
#     rosa login --use-auth-code  # または --use-device-code
#   その後、トークンを取得:
#     export RHCS_TOKEN=$(rosa token)
#
# 注意: MachinePool作成時など、一部の操作ではサービスアカウントでは
# 403エラーが発生する場合があります。その場合はRHCS_TOKENを使用してください。
# RHCS_TOKENは一時トークンで有効期限が短いため、長時間の操作には注意が必要です。

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Terraform変数（TF_VAR_プレフィックスで自動認識）
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
export TF_VAR_aws_region="ap-northeast-1"
export TF_VAR_cluster_name="mta-lightspeed"
export TF_VAR_ocp_version="4.20.2"
export TF_VAR_billing_account="YOUR_BILLING_ACCOUNT_ID"  # 機密情報

# その他のTerraform変数
export TF_VAR_rosa_machine_type="m6a.2xlarge"
export TF_VAR_rosa_replicas="2"
export TF_VAR_vpc_cidr="10.0.0.0/16"
export TF_VAR_availability_zone_count="1"

# 管理者・ワークショップユーザー人数（任意）
# export TF_VAR_admin_count="1"           # 管理者: admin, admin2, ...
# export TF_VAR_workshop_user_count="20"  # 受講者: user1..userN

# HTPasswd IDP 用パスワード（任意・機密情報のためコメントアウト例のみ）
# 管理者ユーザー (admin) 用パスワード
# export TF_VAR_admin_password="YOUR_ADMIN_PASSWORD"
#
# ワークショップユーザー (user1-user50) 共通パスワード
# export TF_VAR_workshop_user_password="YOUR_WORKSHOP_USER_PASSWORD"

# 追加MachinePool設定（任意）
# 1つ目のMachinePoolは module.rosa_hcp が自動で作成（削除不可）
# 2つ目以降の追加MachinePoolを定義する場合は terraform.tfvars で設定してください
# 環境変数での設定は複雑なため、terraform.tfvars の使用を推奨します
# 例: terraform/cluster/terraform.tfvars.example を参照

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# レガシー変数（後方互換性のため保持）
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
export CLUSTER_NAME="${TF_VAR_cluster_name}"
export VPC_NAME="${CLUSTER_NAME}-vpc"
export VPC_CIDR="${TF_VAR_vpc_cidr}"
export OCP_VERSION="${TF_VAR_ocp_version}"
export ROSA_MACHINE_TYPE="${TF_VAR_rosa_machine_type}"
export ROSA_REPLICAS="${TF_VAR_rosa_replicas}"

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "✅ 環境変数を読み込みました"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "AWS設定:"
echo "  Region: ${AWS_DEFAULT_REGION}"
echo ""
echo "Terraform変数:"
echo "  Cluster Name: ${TF_VAR_cluster_name}"
echo "  OCP Version: ${TF_VAR_ocp_version}"
echo "  Machine Type: ${TF_VAR_rosa_machine_type}"
echo "  Replicas: ${TF_VAR_rosa_replicas}"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"


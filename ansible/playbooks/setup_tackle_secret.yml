---
- name: Create Tackle Secret
  hosts: openshift
  gather_facts: false
  tasks:
    - name: Ensure openshift-mta namespace exists
      kubernetes.core.k8s:
        name: openshift-mta
        api_version: v1
        kind: Namespace
        state: present

    - name: Create Secret for Tackle KAI API keys
      kubernetes.core.k8s:
        name: my-kai-secret
        namespace: openshift-mta
        api_version: v1
        kind: Secret
        state: present
        definition:
          metadata:
            name: my-kai-secret
            namespace: openshift-mta
          type: Opaque
          stringData:
            OPENAI_API_BASE: "{{ lookup('env', 'OPENAI_API_BASE') }}"
            OPENAI_API_KEY: "{{ lookup('env', 'OPENAI_API_KEY') }}"
      when:
        - lookup('env', 'OPENAI_API_BASE') | length > 0
        - lookup('env', 'OPENAI_API_KEY') | length > 0
